<!DOCTYPE html>
<!-- saved from url=(0077)http://docusky.org.tw/DocuSky/docuTools/ComposeThdlExportXml/CTEXT/ctext.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <script type="text/javascript" src="https://rise.mpiwg-berlin.mpg.de/jslib/rise_client.js"></script>
   <script src="./js/jquery.min.js"></script>
   <script src="./js/jquery.min.js"></script>
   <script src="./js/jquery-ui.min.js"></script>      <!-- for date formatting -->
   <script src="./js/FileSaver.min.js"></script>      <!-- 輸出儲存 -->
   <script src="./js/pagination.js"></script> 
   <link href="./js/jquery-ui.min.css" rel="stylesheet">
   <script src="./js/docusky.ui.manageDbListSimpleUI.js"></script><style id="dsw-simplecomboui">div.dsw-container { position:absolute; border:#4F4F4F solid 3px; background-color:#EFEFEF; border-radius:4px; display:inline-block; font-family: "Arial","MingLiU"; font-size: 16px; z-index:1001 }div.dsw-titleBar { background-color:#4F4F4F; color:white; z-index:1001; padding: 6px; line-height: 16px; }div.dsw-containerContent { padding: 6px; overflow-x:hidden; overflow-y:auto; font-size:medium; z-index:1001 }.dsw-titleBar table,.dsw-containerContent table { width: 100%; line-height:1.3em; border-collapse: collapse; border-spacing:0; }table.dsw-tableDbCorpuslist { width:100%; margin-right: 16px; border-collapse: collapse; border-spacing: 0; font-size:medium; line-height:1.3em; color:#2F2F3F; }tr.dsw-tr-dbcorpuslist:nth-child(even) { background: #DFDFDF; line-height:1.3em; }tr.dsw-tr-dbcorpuslist:nth-child(odd)  { background: #FFFFFF; line-height:1.3em; }.dsw-titleContainer { width: 60%; padding: 0; }.dsw-closeContainer { position: relative; text-align: right; direction: rtl; padding: 0; }.dsw-titlename { display: inline-block; line-height: 16px; white-space: nowrap; }.dsw-btn-docusky { position: absolute; color:#2F2F2F; background-color:#EFEFEF; border-radius: 3px; font-size: 0.75rem; line-height: 0.75rem; padding: 4px; margin: 0 24px 0 0; cursor: pointer; }.dsw-btn-docusky:hover { background-color:#BFBFBF; color:#96438A; }.dsw-btn-docusky:active { background-color:#BFBFBF; color:#96438A; }.dsw-btn-close { display: inline-block; line-height: 16px; cursor: pointer; }.dsw-btn-close:hover { background-color:#BFBFBF; color:#96438A; }.dsw-btn-close:active { background-color:#BFBFBF; color:#96438A; }.dsw-td-dbcorpuslist { vertical-align: middle; padding: 0.25rem;}.dsw-td-dbcorpuslist-num { text-align: right;}.dsw-displaynameContainer { display: inline-block; width: 50px; white-space: nowrap; overflow: visible; margin: 0 72px 0 0; }.dsw-displayname { display: inline-block; direction: ltr; }.dsw-btn-logout { position: absolute; right: 0; top: -2px; color:#2F2F2F; background-color:#EFEFEF; border-radius: 3px; font-size: 0.75rem; line-height: 0.75rem; padding: 4px; margin: 0 24px 0 0; cursor: pointer; }.dsw-btn-logout:hover { background-color:#BFBFBF; color:#96438A; }.dsw-btn-logout:active { background-color:#BFBFBF; color:#96438A; }.dsw-overlay { display: none; position: absolute; background-color: #AAAAAA; opacity: 0.5; z-index: 1002; height: 100%; width: 100%; }input[type="text"].dsw-userinput,input[type="password"].dsw-userinput { box-sizing: content-box; padding: 2px 8px; border: 1px solid grey; border-radius: 2px; font-size: 14px; height: 20px; width: 150px; }.dsw-td-dslogin { padding: 0; height: 1.75rem; vertical-align: middle; }.dsw-logintitle { padding-right: 6px; }.dsw-loginsubmit { direction: rtl; }.dsw-loginmsg { padding: 0; color: red; font-size: 12px; font-weight: bold; }table.dsw-filenameList { width: 100%; margin-right: 16px; border-collapse: collapse; border-spacing: 0; line-height: 1.25; }.dsw-filenameList td { padding: 0.25rem; vertical-align: top; white-space: nowrap; }.dsw-filenameList-id { text-align: right; }.dsw-filename-download,.dsw-filename.delete { text-align: center; }.dsw-filenameList-category,.dsw-filenameList-path { text-align: left; overflow-x: hidden; text-overflow: ellipsis; }.dsw-filenameList-id {}.dsw-filenameList-download,.dsw-filenameList-delete { width: 45px; max-width: 45px; text-align: center; }.dsw-filenameList-category { font-weight: bold; min-width: 120px; max-width: 150px; }.dsw-filenameList-path { min-width: 450px; max-width: 550px; }.table.dsw-uploadfile{ width: 100%; border-collapse: collapse; border-spacing: 0; }.dsw-uploadfile td { padding: 0; }.dsw-td-dbList { padding: 0.25rem; }.dsw-td-dbList-dbname,.dsw-td-dbList-corpusnames{ text-align:left; border:1px solid #5C5C5C; }.dsw-td-dbList-delete{ text-align: center;  border:1px solid #5C5C5C; }.dsw-td-dbList-dbname{ font-weight:600; min-width: 100px; max-width:180px; word-wrap: break-word; word-break: break-all; }.dsw-td-dbList-corpusnames{ min-width: 450px; max-width: 550px; }.dsw-td-dbList-delete{ min-width:40px; max-width: 60px; white-space: nowrap; }.dsw-dbList-corpusnames-corpusname { display: inline-block; vertical-align: middle; white-space: nowrap; max-width: 250px; overflow-x: hidden; text-overflow: ellipsis; }.dsw-uploadprogressbar { display: none; box-sizing: border-box; height: 20px; width: 100%; margin: 0; padding: 0; border: 1px solid #515F6B; border-radius: 3px; overflow: hidden; background-color: #AFB9C3; }.dsw-uploadprogressbar-progress { display: block; height: 100%; margin: 0; padding: 0; border: 0; background-color: #4C93D4; text-align: center; color: white; white-space: nowrap; }.dsw-dbClick { cursor:pointer; text-decoration:underline; color:blue; }.dsw-corpusAttCntClick { cursor:pointer; text-decoration:underline; color:blue; }.dsw-corpusClick { cursor:pointer; text-decoration:underline; color:blue; }.dsw-attCntClick { cursor:pointer; text-decoration:underline; color:blue; }</style>
   <script src="./js/jquery.csv.js"></script>
   <style type="text/css">
      body { Verdana, Arial, Helvetica, sans-serif, times, Microsoft JhengHei, Heiti TC, PMingLiU, PMingLiu-ExtB, SimSun, SimSun-ExtB, HanaMinA, HanaMinB;
             margin:0; line-height:160%; }
      div.headerBar { background-color:rgb(41,60,65); color:white; padding:8px; text-align: center; }
      table.headerBar { color:rgb(205,174,94); }
      div.contentArea { padding: 12px; }
      table.selectTexts { padding:5px; border:3px solid rgb(180,123,47); background-color:rgb(180,123,47); border-radius:5px; }
      span.butBuildDb { padding:5px; background-color:rgb(122,23,30); color:rgb(205,174,94); 
                        border-radius:3px; cursor:pointer; }
      div.sampleFilesArea { padding:6px; border:3px solid rgb(180,123,47); background-color:rgb(180,123,47); border-radius:4px; }
      a:visited, a:link { color:rgb(122,23,30); }
      a.topAnchor:visited, a.topAnchor:link { color:rgb(225,225,225); cursor:pointer; }
      span.topAnchorSeparator { color:rgb(225,225,225); }
      textarea { resize:none; background-color:rgb(205,174,94); border:2px solid rgb(126,102,80); }
      input#selectInFile { background-color:rgb(180,123,47); }
      
      td.textTitles:nth-child(2n) { background-color:#DFDFFF; }
      td.textTitles:nth-child(2n+1) { background-color:#DFFFDF; }
      span.selectedBook { font-size:80%; margin:2px; padding:2px; border:1px solid black; }
      
      .linear-gradient-headerBar {
         background-color: rgb(41,60,65);
         background-image: -webkit-linear-gradient(left, #778899, rgba(41,60,65,0.8));
         background-image: -moz-linear-gradient(left, #778899, rgba(41,60,65,0.8));
         background-image: -o-linear-gradient(left, #778899, rgba(41,60,65,0.8));
         background-image: -ms-linear-gradient(left, #778899, rgba(41,60,65,0.8));
         background-image: linear-gradient(to left, #778899, rgba(41,60,65,0.8));
      }
      
      .linear-gradient-InputSelection {
         background-color: rgb(180,123,47);
         background: radial-gradient(rgb(205,174,94,0.9), rgba(205,174,94,0.1));
      }
      
      .paginationjs{line-height:1.6;font-family:Marmelad,"Lucida Grande",Arial,"Hiragino Sans GB",Georgia,sans-serif;font-size:14px;box-sizing:initial}.paginationjs:after{display:table;content:" ";clear:both}.paginationjs .paginationjs-pages{float:left}.paginationjs .paginationjs-pages ul{float:left;margin:0;padding:0}.paginationjs .paginationjs-go-button,.paginationjs .paginationjs-go-input,.paginationjs .paginationjs-nav{float:left;margin-left:10px;font-size:14px}.paginationjs .paginationjs-pages li{float:left;border:1px solid #aaa;border-right:none;list-style:none}.paginationjs .paginationjs-pages li>a{min-width:30px;height:28px;line-height:28px;display:block;background:#fff;font-size:14px;color:#333;text-decoration:none;text-align:center}.paginationjs .paginationjs-pages li>a:hover{background:#eee}.paginationjs .paginationjs-pages li.active{border:none}.paginationjs .paginationjs-pages li.active>a{height:30px;line-height:30px;background:#aaa;color:#fff}.paginationjs .paginationjs-pages li.disabled>a{opacity:.3}.paginationjs .paginationjs-pages li.disabled>a:hover{background:0 0}.paginationjs .paginationjs-pages li:first-child,.paginationjs .paginationjs-pages li:first-child>a{border-radius:3px 0 0 3px}.paginationjs .paginationjs-pages li:last-child{border-right:1px solid #aaa;border-radius:0 3px 3px 0}.paginationjs .paginationjs-pages li:last-child>a{border-radius:0 3px 3px 0}.paginationjs .paginationjs-go-input>input[type=text]{width:30px;height:28px;background:#fff;border-radius:3px;border:1px solid #aaa;padding:0;font-size:14px;text-align:center;vertical-align:baseline;outline:0;box-shadow:none;box-sizing:initial}.paginationjs .paginationjs-go-button>input[type=button]{min-width:40px;height:30px;line-height:28px;background:#fff;border-radius:3px;border:1px solid #aaa;text-align:center;padding:0 8px;font-size:14px;vertical-align:baseline;outline:0;box-shadow:none;color:#333;cursor:pointer;vertical-align:middle\9}.paginationjs.paginationjs-theme-blue .paginationjs-go-input>input[type=text],.paginationjs.paginationjs-theme-blue .paginationjs-pages li{border-color:#289de9}.paginationjs .paginationjs-go-button>input[type=button]:hover{background-color:#f8f8f8}.paginationjs .paginationjs-nav{height:30px;line-height:30px}.paginationjs .paginationjs-go-button,.paginationjs .paginationjs-go-input{margin-left:5px\9}.paginationjs.paginationjs-small{font-size:12px}.paginationjs.paginationjs-small .paginationjs-pages li>a{min-width:26px;height:24px;line-height:24px;font-size:12px}.paginationjs.paginationjs-small .paginationjs-pages li.active>a{height:26px;line-height:26px}.paginationjs.paginationjs-small .paginationjs-go-input{font-size:12px}.paginationjs.paginationjs-small .paginationjs-go-input>input[type=text]{width:26px;height:24px;font-size:12px}.paginationjs.paginationjs-small .paginationjs-go-button{font-size:12px}.paginationjs.paginationjs-small .paginationjs-go-button>input[type=button]{min-width:30px;height:26px;line-height:24px;padding:0 6px;font-size:12px}.paginationjs.paginationjs-small .paginationjs-nav{height:26px;line-height:26px;font-size:12px}.paginationjs.paginationjs-big{font-size:16px}.paginationjs.paginationjs-big .paginationjs-pages li>a{min-width:36px;height:34px;line-height:34px;font-size:16px}.paginationjs.paginationjs-big .paginationjs-pages li.active>a{height:36px;line-height:36px}.paginationjs.paginationjs-big .paginationjs-go-input{font-size:16px}.paginationjs.paginationjs-big .paginationjs-go-input>input[type=text]{width:36px;height:34px;font-size:16px}.paginationjs.paginationjs-big .paginationjs-go-button{font-size:16px}.paginationjs.paginationjs-big .paginationjs-go-button>input[type=button]{min-width:50px;height:36px;line-height:34px;padding:0 12px;font-size:16px}.paginationjs.paginationjs-big .paginationjs-nav{height:36px;line-height:36px;font-size:16px}.paginationjs.paginationjs-theme-blue .paginationjs-pages li>a{color:#289de9}.paginationjs.paginationjs-theme-blue .paginationjs-pages li>a:hover{background:#e9f4fc}.paginationjs.paginationjs-theme-blue .paginationjs-pages li.active>a{background:#289de9;color:#fff}.paginationjs.paginationjs-theme-blue .paginationjs-pages li.disabled>a:hover{background:0 0}.paginationjs.paginationjs-theme-blue .paginationjs-go-button>input[type=button]{background:#289de9;border-color:#289de9;color:#fff}.paginationjs.paginationjs-theme-green .paginationjs-go-input>input[type=text],.paginationjs.paginationjs-theme-green .paginationjs-pages li{border-color:#449d44}.paginationjs.paginationjs-theme-blue .paginationjs-go-button>input[type=button]:hover{background-color:#3ca5ea}.paginationjs.paginationjs-theme-green .paginationjs-pages li>a{color:#449d44}.paginationjs.paginationjs-theme-green .paginationjs-pages li>a:hover{background:#ebf4eb}.paginationjs.paginationjs-theme-green .paginationjs-pages li.active>a{background:#449d44;color:#fff}.paginationjs.paginationjs-theme-green .paginationjs-pages li.disabled>a:hover{background:0 0}.paginationjs.paginationjs-theme-green .paginationjs-go-button>input[type=button]{background:#449d44;border-color:#449d44;color:#fff}.paginationjs.paginationjs-theme-yellow .paginationjs-go-input>input[type=text],.paginationjs.paginationjs-theme-yellow .paginationjs-pages li{border-color:#ec971f}.paginationjs.paginationjs-theme-green .paginationjs-go-button>input[type=button]:hover{background-color:#55a555}.paginationjs.paginationjs-theme-yellow .paginationjs-pages li>a{color:#ec971f}.paginationjs.paginationjs-theme-yellow .paginationjs-pages li>a:hover{background:#fdf5e9}.paginationjs.paginationjs-theme-yellow .paginationjs-pages li.active>a{background:#ec971f;color:#fff}.paginationjs.paginationjs-theme-yellow .paginationjs-pages li.disabled>a:hover{background:0 0}.paginationjs.paginationjs-theme-yellow .paginationjs-go-button>input[type=button]{background:#ec971f;border-color:#ec971f;color:#fff}.paginationjs.paginationjs-theme-red .paginationjs-go-input>input[type=text],.paginationjs.paginationjs-theme-red .paginationjs-pages li{border-color:#c9302c}.paginationjs.paginationjs-theme-yellow .paginationjs-go-button>input[type=button]:hover{background-color:#eea135}.paginationjs.paginationjs-theme-red .paginationjs-pages li>a{color:#c9302c}.paginationjs.paginationjs-theme-red .paginationjs-pages li>a:hover{background:#faeaea}.paginationjs.paginationjs-theme-red .paginationjs-pages li.active>a{background:#c9302c;color:#fff}.paginationjs.paginationjs-theme-red .paginationjs-pages li.disabled>a:hover{background:0 0}.paginationjs.paginationjs-theme-red .paginationjs-go-button>input[type=button]{background:#c9302c;border-color:#c9302c;color:#fff}.paginationjs.paginationjs-theme-red .paginationjs-go-button>input[type=button]:hover{background-color:#ce4541}.paginationjs .paginationjs-pages li.paginationjs-next{border-right:1px solid #aaa\9}.paginationjs .paginationjs-go-input>input[type=text]{line-height:28px\9;vertical-align:middle\9}.paginationjs.paginationjs-big .paginationjs-pages li>a{line-height:36px\9}.paginationjs.paginationjs-big .paginationjs-go-input>input[type=text]{height:36px\9;line-height:36px\9}
   </style>
</head><div id="DbList_loginContainer_0" class="dsw-container" style="display: none;"><div id="DbList_loginContainerOverlay_0" class="dsw-overlay"></div><div class="dsw-titleBar"><table><tbody><tr><td class="dsw-titleContainer"><div class="dsw-titlename">DocuSky Login</div></td><td class="dsw-closeContainer" id="DbList_closeLoginContainer_0"><span class="dsw-btn-close" id="DbList_closeLoginButton_0">✖</span></td></tr></tbody></table></div><div class="dsw-containerContent"><table><tbody><tr><td class="dsw-td-dslogin dsw-logintitle">Username:</td><td class="dsw-td-dslogin"><input type="text" class="dsw-userinput" id="DbList_dsUsername_0"></td></tr><tr><td class="dsw-td-dslogin dsw-logintitle">Password:</td><td class="dsw-td-dslogin"><input type="password" class="dsw-userinput" id="DbList_dsPassword_0"></td></tr><tr><td class="dsw-td-dslogin dsw-loginsubmit" colspan="2"><input id="DbList_loginSubmit_0" type="submit" value="登入"></td></tr><tr><td colspan="2" class="dsw-loginmsg" id="DbList_loginMessage_0"></td></tr></tbody></table></div></div><div id="DbList_dbListContainer_0" class="dsw-container" style="display: none;"><div class="dsw-titleBar"><table><tbody><tr><td class="dsw-titleContainer"><div class="dsw-titlename" title="docusky.ui.manageDbListSimpleUI.js - Ver 0.15">資料庫文獻集列表</div>&nbsp;&nbsp;&nbsp;<span class="dsw-btn-docusky" id="DbList_DocuSkyLinkAnchor_0">DocuSky</span></td><td class="dsw-closeContainer"><div class="dsw-btn-close" id="DbList_closeDbList_0">✖</div><span class="dsw-btn-logout" id="DbList_logoutAnchor_0">Logout</span><span class="dsw-displaynameContainer"><span class="dsw-displayname" id="DbList_spanDisplayname_0"></span></span></td></tr></tbody></table></div><div id="DbList_dbListContent_0" class="dsw-containerContent"></div><hr width="96%"><div id="DbList_dbListImportToBuildDb_0" class="dsw-containerContent"><form id="DbList_uploadForm_0" name="uploadForm"><div>上載單份 ThdlExportXml 檔以建構文字資料庫：<input type="file" id="DbList_uploadXmlFile_0" name="importedFiles[]" accept=".xml"></div><table class="dsw-uploadfile"><tbody><tr><td>資料庫名稱:</td>    <td><input type="text" class="dsw-userinput" id="DbList_dbTitleForImport_0" name="dbTitleForImport" value="Default"></td>    <td width="40%"><div class="dsw-uploadprogressbar" id="DbList_uploadProgress_0"><div class="dsw-uploadprogressbar-progress"></div></div></td>    <td align="right"><button id="DbList_uploadXmlToBuildDb_0" disabled="disabled">開始上傳</button></td></tr></tbody></table></form></div></div><div id="DbList_loadingContainer_0" style="position: absolute; border: 3px solid grey; border-radius: 6px; background-color: white; z-index: 1003; display: none;"><div id="DbList_loadingSign_0"><img src="./js/loading-circle.gif" width="140" border="0"></div><div id="DbList_workingProgressId_0" style="position:absolute; top:60px; width:100%; text-align:center;;"></div></div>
<body cz-shortcut-listen="true">
   <div id="headerBar" class="headerBar linear-gradient-headerBar">
      <table class="headerBar" width="100%">
      <tbody><tr><td width="120" style="font-size:120%"><b>DocuSky</b><span style="font-size:60%;vertical-align:sub">BETA</span></td>
          <td><span style="font-size:110%">從 ctext 下載全文，組成 DocuXml 並可上載建庫的小工具</span></td>
          <td align="right">
             <a class="topAnchor" href="http://docusky.org.tw/DocuSky/">首頁</a> 
             <span class="topAnchorSeparator">|</span> <a class="topAnchor" href="http://docusky.org.tw/DocuSky/docuTools/userMain/">我的資料庫</a>
          </td>
      </tr>
      </tbody></table>
   </div>
   <div style="padding:5px;">
      <table>
      <tbody><tr><td colspan="2">
         <b>1. Select a Collection:</b> <select id='collectionsList'><option>Select a Collection</option></select><br>
      </td></tr>
      <tr><td width="25%">
         書名過濾: <input id="inputBookFilter" type="text" size="6" autocomplete="off">
      </td><td>
         <div id="paginationContainer"><div class="paginationjs"><div class="paginationjs-pages"><ul><li class="paginationjs-page J-paginationjs-page active" data-num="1"><a>1</a></li><li class="paginationjs-page J-paginationjs-page" data-num="2"><a href="http://docusky.org.tw/DocuSky/docuTools/ComposeThdlExportXml/CTEXT/ctext.html">2</a></li><li class="paginationjs-page J-paginationjs-page" data-num="3"><a href="http://docusky.org.tw/DocuSky/docuTools/ComposeThdlExportXml/CTEXT/ctext.html">3</a></li><li class="paginationjs-page J-paginationjs-page" data-num="4"><a href="http://docusky.org.tw/DocuSky/docuTools/ComposeThdlExportXml/CTEXT/ctext.html">4</a></li><li class="paginationjs-page J-paginationjs-page" data-num="5"><a href="http://docusky.org.tw/DocuSky/docuTools/ComposeThdlExportXml/CTEXT/ctext.html">5</a></li><li class="paginationjs-ellipsis disabled"><a>...</a></li><li class="paginationjs-page paginationjs-last J-paginationjs-page" data-num="32"><a href="http://docusky.org.tw/DocuSky/docuTools/ComposeThdlExportXml/CTEXT/ctext.html">32</a></li><li class="paginationjs-next J-paginationjs-next" data-num="2" title="Next page"><a href="http://docusky.org.tw/DocuSky/docuTools/ComposeThdlExportXml/CTEXT/ctext.html">»</a></li></ul></div><div class="paginationjs-nav J-paginationjs-nav"><span style="color: #f00">1</span> / 32 pages, 31732 entries</div></div></div>   
      </td></tr>
      </tbody></table>
      <div style="overflow-x:hidden; overflow-y:scroll; height:280px; border:2px solid grey; border-radius:4px; margin:5px; box-shadow:5px 5px 5px #888888;">
      <div id="messageOverlay" style="position: absolute; top: 180px; left: 25%; width: 50%; border: 3px double grey; border-radius: 4px; padding: 18px; font-size: 125%; background-color: rgb(255, 255, 153); z-index: 100; text-align: center; display: none;">載入書名清單...</div>
      <table id="resourcesList" width="100%">
         <tbody>
         <tr>
         </tr>
      </tbody></table>
   </div>
   <div style="margin-left:10px; padding:3px;">
      <span id="resourcesSelectedCounter">0</span> resources selected
      <span id="resourcesSelected" style="margin-left:10px"></span>
   </div>
   </div>
   <div class="contentArea">
      <!--
      <b>1. 先 <button id="downloadTexts" disabled="disabled">下載</button> ctext 文本
      <br/>
      -->
      <hr>
      <b>2. 將 DocuXml 儲存在本地硬碟</b><br>
      輸出的建庫檔名：<input type="text" id="outFilename" placeholder="DefaultExport.xml" value="" size="45" autocomplete="off">
      <button id="downloadAndSave" disabled="disabled">點我下載並儲存</button>
      <br>
      <hr>
      <table width="100%" border="0">
         <tbody><tr id="transformers" class="tableRow">
            <td width="100%" class="toolType">
               <b>3. 上載 DocuXml 檔案，以建構個人文字庫（需有 DocuSky 帳號）</b><br>
            </td>
         </tr>
         <tr>
            <td style="padding:10px">
               <div>
               <span id="manageDbList" class="butBuildDb">
                  點我建構或刪除文字庫
               </span><span style="font-size:smaller">（檔案大小上限 100MB）</span>
               </div>
            </td>
         </tr>
      </tbody></table>   
   </div>

<script type="text/javascript">   
   var DocuSkyObj = null;         // first letter capital to denote global variables
   var CtextJsonObj = {};
   var FilteredBooks = [];
   var CtextDownloadable = false;
   var CtextSelectedBooks = [];
   var CorpusList = {};           // { corpusTitle: [{filename,docXml},{filename,docXml}, ...] }
   var PrevFilterStr = '';
   var PageSize = 1000, CurPage = 1;

      
   function refreshCorpusList() {
      var s = "<ol>";
      for (var corpusTitle in CorpusList) {
         s += "<li>" + corpusTitle + " (" + CorpusList[corpusTitle].length + ")</li>";
      }
      s += "</ol>";
      $("#corpusList").html(s);
   }
   
   var showPagination = function(books) {
      if (typeof $('#paginationContainer')['destroy'] === 'function') $('#paginationContainer').destroy();
      $('#paginationContainer').pagination({
         dataSource: books,
         pageSize: 1000,
         autoHidePrevious: true,
         autoHideNext: true,
         showNavigator: true,
         formatNavigator: '<span style="color: #f00"><%= currentPage %></span> / <%= totalPage %> pages, <%= totalNumber %> entries',
         callback: function(data, pagination) {
            var colSize = Math.ceil(data.length / 2);
            [0,1].forEach(function(col) {
               $("#divTextTitle" + col).empty();
            });
            data.forEach(function(item, n) {
               var aux = (typeof(item.author) === 'undefined') ? item.urn : ((item.author ? item.author : '-') + ';' + item.urn);
               var found = CtextSelectedBooks.find(function(sItem) {
                  return (sItem.urn === item.urn);
               });
               var checkedStr = (found) ? " checked='checked'" : "";     
               var row = "<div><input name='bt' type='checkbox' value='" + item.urn + "' title='" + item.title + "'" + checkedStr + ">" + item.title + " (" + aux + ")</input></div>";
               var col = Math.floor(n / colSize);
               $("#divTextTitle" + col).append(row);
            });

            $("#tableTextTitles input:checkbox").change(function() {
               var checkedTitle = $(this).attr("title");
               var checkedUrn = $(this).val();
               var idx = CtextSelectedBooks.findIndex(function(item) {
                  return (item.urn === checkedUrn);
               });
               if ($(this).is(":checked")) { 
                  if (idx === -1) {
                     var ctextBook = { title: checkedTitle,
                                       urn: checkedUrn }
                     CtextSelectedBooks.push(ctextBook);
                  }
               }
               else {
                  if (idx >= 0) CtextSelectedBooks.splice(idx, 1);       // remove 1 element
               }
               
               var checkedCount = CtextSelectedBooks.length;
               $("#downloadAndSave").prop("disabled",(checkedCount == 0));
               $("#spanSelectedCount").text(checkedCount);
               var s = '';
               CtextSelectedBooks.forEach(function(item) {
                  s += "<span class='selectedBook'>" + item.title + "</span>";
               });
               $("#spanTextTitleSelected").html(s);
               
               var outFilename = $("#outFilename").val();
               var today = $.datepicker.formatDate('yymmdd', new Date());    // 'yy-mm-dd' for YYYY-MM-DD
               var newFilename = "CTEXT_" + today + "_" + checkedCount + "_books.xml";
               $("#outFilename").val(newFilename);
            });
         }
      });
   }

   var composeDocuXml = function(callback) {
      //alert(JSON.stringify(CtextSelectedBooks));
      // CorpusList := { corpusTitle: [{filename,docXml},{filename,docXml}, ...] }
      CorpusList = {};
            
      var today = $.datepicker.formatDate('yymmdd', new Date());    // 'yy-mm-dd' for YYYY-MM-DD
      var corpusTitle = today + '-' + 'ctext_' + CtextSelectedBooks.length + '_books';   // 目前先固定（不讓使用者指定）
      var corpusDocuments = [];
      CtextSelectedBooks.forEach(function(book, bookIdx) {
         book.chapters.forEach(function(chapter, chapterIdx) {
            var chapterTitle = htmlEncode(chapter.title);           // 2018-11-02
            var chapterFulltext = "";
            if (chapter.fulltext !== undefined) {
               chapter.fulltext.forEach(function(text) {
                  chapterFulltext += "<Paragraph>" + htmlEncode(text) + "</Paragraph>\n";
               });
            } else if (chapter.sections !== undefined) {     // 2018-11-02
               chapter.sections.forEach(function(sectionXml) {
                  chapterFulltext += "<Paragraph>" + sectionXml + "</Paragraph>\n";
               });
            }
            var filename = "ctext_" + book.title + "_" + bookIdx + "_" + chapterIdx;
            var doc = "<document filename='" + filename + "'>"
                    + "<corpus>" + corpusTitle + "</corpus>"
                    + "<compilation>" + book.title + "</compilation>"
                    + "<title>" + chapter.title + "</title>"
                    + "<doc_content>"
                    + chapterFulltext
                    + "</doc_content>"
                    + "</document>";
            corpusDocuments.push({ filename:filename, docXml:doc });
         });
      });
      CorpusList[corpusTitle] = corpusDocuments;
      //alert(JSON.stringify(CorpusList));
      alert("成功下載 " + CtextSelectedBooks.length + " 本書");
      if (typeof(callback) === 'function') callback();
   };
   
   
   $("#inputBookFilter").on("keyup change paste input", function() {
      var filterStr = $(this).val().trim();
      if (filterStr === PrevFilterStr) return;
      PrevFilterStr = filterStr;
      $("#messageOverlay").text("過濾書名中...").show();
      var total = $("#tableTextTitles input:checkbox").length;
      var n = total;
      window.setTimeout(function() { 
         var FilteredBooks = [];
         CtextJsonObj.books.forEach(function(item) {
            if (item['title'].indexOf(filterStr) !== -1) FilteredBooks.push(item);
         });
         showPagination(FilteredBooks);
         $("#messageOverlay").hide();
      }, 200);
   });

   function displayCollectionSelect(collections){
      $.each(collections, function( index, collection ) {
        option = "<option id='"+ collection['uuid'] +"'>"+ collection['name'] +"</option>";
        $('#collectionsList').append(option);
      });
   }

   function displayResourcesTable(resources){
      $.each(resources, function( index, resource ) {
        row = "<tr><td id='"+ resource['uuid'] +"'><input name='bt' type='checkbox' value='"+ resource['uuid'] +"' title='"+ resource['name'] +"'>"+ resource['name'] +"</td></tr>";
        $('#resourcesList tr:last').after(row);
      });      
   }

   $('#collectionsList').change(function() {
      $('#resourcesList').html('<tbody><tr></tr></tbody>');
      var collectionUuid = $(this).children(":selected").attr("id");
      rise.collections.resources(collectionUuid)
        .then(function(response){
          resources = response.body;
          displayResourcesTable(resources);
          checkSelectedResource();
        })
        .catch(function(error){
          console.log(error.response.body);
          console.log(error.status);
        });
   });

   var selectedResourceUuids = [];
   var selectedResourceNames = [];

   function checkSelectedResource() {
      $.each(selectedResourceUuids, function( index, uuid ) {
        var checkbox = $("input[type='checkbox'][value='"+uuid+"']");
        checkbox.attr("checked","checked");        
      });
   }

   $(document.body).on('change', 'input[type=checkbox]', function () {
    var el = $(this);

   if(el.is(':checked')){
      selectedResourceUuids.push(el.val());
      selectedResourceNames.push(el.attr('title'));
   }
   else{
      
      for( var i = 0; i < selectedResourceUuids.length; i++){ 
        if ( selectedResourceUuids[i] === el.val()) {
         selectedResourceUuids.splice(i, 1); 
      }
      for( var i = 0; i < selectedResourceNames.length; i++){ 
        if ( selectedResourceNames[i] === el.attr('title')) {
         selectedResourceNames.splice(i, 1); 
      }
   }

}
   }
   
   $('#resourcesSelectedCounter').html(selectedResourceUuids.length);
   $('#resourcesSelected').html(selectedResourceNames.join(', '));
});
   
   $(document).ready(function() {
      DocuSkyObj = docuskyManageDbListSimpleUI;
      $("#manageDbList").click(function(e) {
         DocuSkyObj.manageDbList(e);
      });

      rise.init.setRemote();
      rise.collections.all()
        .then(function(response){
          collections = response.body;
          displayCollectionSelect(collections);
        })
        .catch(function(error){
          // in case something goes wrong, the error
          // data is made available in the
          // catch function
          console.log(error.response.body);
          console.log(error.status);
        }); 


   });
</script>
</body></html>